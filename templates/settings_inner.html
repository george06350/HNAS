<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>设置</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
    html, body {
        height: 100%;
    }
    body {
        background: linear-gradient(120deg,#21232b 70%,#242a35 100%);
        color: #e8eaf0;
        font-family: 'Segoe UI', Arial, sans-serif;
        min-height: 100vh;
        margin: 0;
        box-sizing: border-box;
    }
    .settings-root {
        display: flex;
        min-height: 0;
        min-width: 0;
        height: 100vh;
        max-height: 100vh;
    }
    .settings-sidebar {
        width: 240px;
        background: rgba(30,33,39,0.98);
        border-right: 1px solid #23242a;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        padding-top: 30px;
        min-width: 170px;
        max-width: 100vw;
        box-sizing: border-box;
        overflow-y: auto;
        overflow-x: hidden;
    }
    .settings-sidebar-profile {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 28px;
        padding: 0 10px;
    }
    .settings-sidebar-profile .avatar {
        width: 66px;
        height: 66px;
        border-radius: 50%;
        background: #36383e;
        margin-bottom: 7px;
    }
    .settings-sidebar-profile .nickname {
        font-size: 1.07em;
        color: #fff;
        font-weight: bold;
        margin-bottom: 2px;
        word-break: break-all;
        text-align: center;
    }
    .settings-sidebar-profile .email {
        color: #acb2be;
        font-size: 0.94em;
        word-break: break-all;
        text-align: center;
    }
    .settings-sidebar-nav {
        flex: 1 1 auto;
        display: flex;
        flex-direction: column;
        gap: 4px;
        margin-bottom: 12px;
    }
    .sidebar-nav-item {
        display: flex;
        align-items: center;
        padding: 8px 0 8px 36px;
        color: #dbe3f3;
        font-size: 1.03em;
        border-left: 4px solid transparent;
        cursor: pointer;
        border-radius: 0 18px 18px 0;
        transition: background 0.13s, color 0.13s;
        gap: 12px;
        min-width: 0;
        word-break: break-all;
    }
    .sidebar-nav-item.active,
    .sidebar-nav-item:hover {
        background: #242b35;
        color: #55aaff;
        border-left: 4px solid #3a82f7;
    }
    .sidebar-nav-item svg {
        opacity: 0.85;
        margin-right: 3px;
        min-width: 20px;
    }
    .settings-content {
        flex: 1 1 auto;
        min-width: 0;
        min-height: 0;
        height: 100vh;
        overflow: auto;
        background: transparent;
        display: flex;
        flex-direction: column;
    }
    .settings-content-inner {
        max-width: 820px;
        margin: 0 auto;
        padding: 0 2vw 32px 2vw;
        min-width: 0;
        min-height: 0;
        box-sizing: border-box;
        width: 100%;
    }
    .settings-title {
        font-size: 2.1em;
        font-weight: 500;
        color: #fff;
        margin-bottom: 15px;
        letter-spacing: 1px;
        margin-top: 18px;
    }
    .settings-section {
        background: rgba(40,43,52,0.97);
        border-radius: 18px;
        padding: 28px 28px 18px 28px;
        margin-bottom: 22px;
        box-shadow: 0 2px 18px #181d2422;
        border: 1px solid #23242a;
        min-width: 0;
    }
    .section-title {
        font-size: 1.16em;
        font-weight: 600;
        color: #70aaff;
        margin-bottom: 14px;
        letter-spacing: 0.5px;
    }
    .settings-label {
        color: #9cb4d4;
        font-size: 1em;
        margin-bottom: 4px;
    }
    .settings-value {
        color: #eaf2ff;
        font-size: 1.08em;
        margin-bottom: 10px;
        word-break: break-all;
    }
    .settings-form input[type="password"],
    .settings-form input[type="text"] {
        background: #22242a;
        color: #fff;
        border: 1px solid #2e3140;
        border-radius: 7px;
        padding: 6px 12px;
        width: 150px;
        max-width: 100%;
        box-sizing: border-box;
    }
    .settings-form .btn {
        background: #3a82f7;
        border: none;
        border-radius: 16px;
        font-weight: 600;
        padding: 8px 24px;
        margin-top: 2px;
        margin-left: 0;
        transition: background 0.13s;
    }
    .settings-form .btn:hover {
        background: #2368bb;
    }
    .settings-tip {
        color: #8891a0;
        font-size: 0.95em;
        margin-left: 8px;
    }
    .alert {
        border-radius: 10px;
        font-size: 1em;
        margin-top: 10px;
        background: #202a32;
        color: #6fe4ff;
        border: 1px solid #2e3a4a;
        word-break: break-all;
    }
    ::-webkit-scrollbar {
        width: 9px;
        background: #21232b;
    }
    ::-webkit-scrollbar-thumb {
        background: #2e3440;
        border-radius: 6px;
    }
    @media (max-width: 1024px) {
        .settings-content-inner { max-width: 98vw; }
        .settings-section { padding: 18px 8vw 12px 6vw; }
    }
    @media (max-width: 800px) {
        .settings-root { flex-direction: column; height: auto; max-height: none;}
        .settings-sidebar { width: 100vw; flex-direction: row; padding-top: 10px; border-right: none; border-bottom: 1px solid #222; min-width: 0;}
        .settings-sidebar-profile { flex-direction: row; margin-bottom: 0; margin-left: 8px; padding: 0 5px;}
        .settings-sidebar-nav { flex-direction: row; gap: 0; margin-bottom: 0; }
        .sidebar-nav-item { flex: 1 1 0; padding: 8px 8px 8px 18px; border-radius: 11px 11px 0 0; min-width: 0; font-size: 1em;}
        .settings-title { margin-top: 12px; }
        .settings-content-inner { padding: 0 2vw; }
    }
    @media (max-width: 600px) {
        .settings-content-inner { padding: 0 2vw; }
        .settings-section { padding: 10px 4vw 8px 4vw; }
        .settings-sidebar { padding-top: 0; }
        .settings-title { font-size: 1.3em; }
    }
    @media (max-width:400px) {
        .settings-section { padding: 5px 2vw 6px 2vw; }
    }
    </style>
    <script>
    // 切换tab
    function showTab(tab) {
        document.querySelectorAll('.sidebar-nav-item').forEach(function(item){
            item.classList.remove('active');
        });
        document.getElementById('nav-'+tab).classList.add('active');
        document.querySelectorAll('.settings-tab').forEach(function(div){
            div.style.display = 'none';
        });
        document.getElementById('tab-'+tab).style.display = '';
    }
    </script>
</head>
<body>
<div class="settings-root">
    <!-- 左侧侧边栏 -->
    <div class="settings-sidebar">
        <div class="settings-sidebar-profile">
            <img class="avatar" src="https://img.icons8.com/ios-filled/100/cccccc/user-male-circle.png" alt="avatar">
            <div class="nickname">{{ username }}</div>
            <div class="email">{{ user_email or '' }}</div>
        </div>
        <div class="settings-sidebar-nav">
            <div class="sidebar-nav-item active" id="nav-account" onclick="showTab('account')">
                <svg width="22" height="22" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4" fill="#70aaff"/><path d="M4 20c0-4 8-4 8-4s8 0 8 4v1H4v-1z" fill="#70aaff"/></svg>
                账号设置
            </div>
            <div class="sidebar-nav-item" id="nav-system" onclick="showTab('system')">
                <svg width="22" height="22" viewBox="0 0 24 24"><rect x="3" y="6" width="18" height="12" rx="3" fill="#70aaff"/><rect x="8" y="10" width="8" height="4" rx="2" fill="#21232b"/></svg>
                系统信息
            </div>
            <div class="sidebar-nav-item" id="nav-users" onclick="showTab('users')">
                <svg width="22" height="22" viewBox="0 0 24 24"><circle cx="8" cy="9" r="4" fill="#70aaff"/><circle cx="17" cy="11" r="3" fill="#70aaff"/><path d="M2 22c0-3 6-3 6-3s6 0 6 3v1H2v-1z" fill="#70aaff"/><path d="M13 22c0-2 4-2 4-2s4 0 4 2v1h-8v-1z" fill="#70aaff"/></svg>
                多用户管理
            </div>
            <div class="sidebar-nav-item" id="nav-wallpaper" onclick="showTab('wallpaper')">
                <svg width="22" height="22" viewBox="0 0 24 24"><rect x="2" y="5" width="20" height="14" rx="3" fill="#70aaff"/><circle cx="8" cy="13" r="2.5" fill="#21232b"/><rect x="13" y="11" width="6" height="5" rx="1.5" fill="#21232b"/></svg>
                壁纸设置
            </div>
        </div>
    </div>
    <!-- 右侧内容 -->
    <div class="settings-content">
        <div class="settings-content-inner">
            <div class="settings-title">设置</div>
            <!-- 账号设置 -->
            <div class="settings-section settings-tab" id="tab-account">
                <div class="section-title">账号设置</div>
                <div class="settings-label">用户名</div>
                <div class="settings-value">{{ username }}</div>
                <form method="post" class="settings-form">
                    <div class="settings-label mt-2">更改密码</div>
                    <input type="password" name="new_password" placeholder="新密码">
                    <button type="submit" class="btn btn-primary ms-2">保存</button>
                    <span class="settings-tip">密码留空不更改</span>
                </form>
                {% if message %}
                <div class="alert alert-info">{{ message }}</div>
                {% endif %}
            </div>
            <!-- 系统信息 -->
            <div class="settings-section settings-tab" id="tab-system" style="display:none;">
                <div class="section-title">系统信息</div>
                <div class="settings-label">主机名</div>
                <div class="settings-value">{{ sysinfo.hostname }}</div>
                <div class="settings-label">操作系统</div>
                <div class="settings-value">{{ sysinfo.os }}</div>
                <div class="settings-label">系统架构</div>
                <div class="settings-value">{{ sysinfo.arch }}</div>
                <div class="settings-label">Python 版本</div>
                <div class="settings-value">{{ sysinfo.python_version }}</div>
                <div class="settings-label">服务器时间</div>
                <div class="settings-value">{{ sysinfo.now }}</div>
            </div>
            <!-- 多用户管理 -->
            <div class="settings-section settings-tab" id="tab-users" style="display:none;">
                <div class="section-title">多用户管理</div>
                <form method="post" style="margin-bottom:18px; display:flex; flex-wrap:wrap; gap:10px; align-items:center;">
                    <input type="hidden" name="action" value="create_user">
                    <input name="new_username" class="form-control" style="width:150px;max-width:40vw;" placeholder="新用户名">
                    <input name="new_password" type="password" class="form-control" style="width:150px;max-width:40vw;" placeholder="新密码">
                    <button type="submit" class="btn btn-success">创建用户</button>
                </form>
                <div class="settings-label mb-2">用户列表：</div>
                <div style="overflow-x:auto;">
                <table class="table table-dark table-striped table-hover align-middle" style="border-radius:10px;overflow:hidden;">
                    <thead><tr>
                        <th>用户名</th>
                        <th>注册时间</th>
                        <th>权限</th>
                        {% if super_admin %}<th>操作</th>{% endif %}
                    </tr></thead>
                    <tbody>
                    {% for u in users %}
                        <tr>
                            <td>{{ u.username }}</td>
                            <td style="font-size:0.97em;">{{ u.register_time or '-' }}</td>
                            <td>
                                {% if loop.index0 == 0 %}<span style="color:#2ee;">超级管理员</span>
                                {% else %}<span style="color:#ccc;">普通用户</span>{% endif %}
                            </td>
                            {% if super_admin %}
                            <td>
                                {% if u.username != username and u.username != users[0].username %}
                                <form method="post" style="display:inline;">
                                    <input type="hidden" name="action" value="delete_user">
                                    <input type="hidden" name="del_username" value="{{ u.username }}">
                                    <button class="btn btn-danger btn-sm" type="submit" onclick="return confirm('确定要删除该用户吗？');">删除</button>
                                </form>
                                {% elif u.username == users[0].username %}
                                <span style="color:#888;">（超级管理员）</span>
                                {% elif u.username == username %}
                                <span style="color:#888;">（自己）</span>
                                {% endif %}
                            </td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                </div>
                <div class="settings-tip">只有超级管理员（第一个注册的账号）可删除其他账号。</div>
            </div>
            <!-- 壁纸设置 -->
            <div class="settings-section settings-tab" id="tab-wallpaper" style="display:none;">
                <div class="section-title">壁纸设置</div>
                <form method="post" class="mb-3" style="max-width:400px;">
                    <input type="hidden" name="action" value="change_wallpaper">
                    <div class="settings-label">桌面壁纸1</div>
                    <select name="wallpaper1" class="form-select mb-2">
                        {% for f in wall_files %}
                        <option value="{{f}}" {% if f==current_wallpapers.wallpaper1 %}selected{% endif %}>{{f}}</option>
                        {% endfor %}
                    </select>
                    <div class="settings-label">桌面壁纸2</div>
                    <select name="wallpaper2" class="form-select mb-2">
                        {% for f in wall_files %}
                        <option value="{{f}}" {% if f==current_wallpapers.wallpaper2 %}selected{% endif %}>{{f}}</option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="btn btn-primary">保存壁纸设置</button>
                </form>
                <div class="row">
                    <div class="col-6">
                        <div class="settings-label">壁纸1预览：</div>
                        <img src="/wallpaper/{{current_wallpapers.wallpaper1}}" alt="壁纸1" style="width:100%;max-width:260px;border-radius:12px;box-shadow:0 2px 12px #0002;">
                    </div>
                    <div class="col-6">
                        <div class="settings-label">壁纸2预览：</div>
                        <img src="/wallpaper/{{current_wallpapers.wallpaper2}}" alt="壁纸2" style="width:100%;max-width:260px;border-radius:12px;box-shadow:0 2px 12px #0002;">
                    </div>
                </div>
                <div class="settings-tip mt-3" style="font-size:0.96em;">如需添加壁纸，请将图片放入 <code>/data/system/wallpaper</code> 目录。</div>
            </div>
        </div>
    </div>
</div>
<script>
showTab('account');
</script>
</body>
</html>